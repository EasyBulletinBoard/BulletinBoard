{% extends "base.html" %}

{% block title %}{{ board.name }}{% endblock %}

{% block content %}
<h1>{{ board.name }}</h1>

<h2>BeitrÃ¤ge</h2>
<ul style="list-style: none; padding: 0;">
    {% for card in cards %}
        <div class="card">
            <strong>{{ card.title }}</strong>
            <button class="like-card-button" data-card-id="{{ card.id }}">
                {% if request.user in card.liked_by.all %}
                    ğŸ‘
                {% else %}
                    ğŸ‘
                {% endif %}
            </button>
            <span class="likes-count" data-card-id="{{ card.id }}">Likes: {{ card.likes }}</span>
            <br>
            <small>von {{ card.author }} am {{ card.created_at }}</small>
            <p>{{ card.content }}</p>
            {% if card.attachment %}
                <img src="/media/{{ card.attachment }}" alt="Anhang">
            {% endif %}
        </div>
    {% endfor %}
</ul>

<script>
    document.querySelectorAll('.like-card-button').forEach(button => {
        button.addEventListener('click', function() {
            const cardId = this.getAttribute('data-card-id');
            console.log(cardId);
            fetch(`/boards/cards/${cardId}/like/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                document.querySelector(`.likes-count[data-card-id="${cardId}"]`).textContent = 'Likes: ' + data.likes;
                this.textContent = this.textContent === 'ğŸ‘' ? 'ğŸ‘' : 'ğŸ‘';
            });
        });
    });
</script>

{% endblock %}  